var simulate_timer,table,id=0;function isIpAddressValid(e){var t=e.split(":"),a=t[0].split(".");if(validateNum(t[1],1,65535))return 4==a.length&&a.every(function(e){return validateNum(e,0,255)});jQuery.jGrowl("Пожалуйста, введите правильный порт.",{life:5e3,glue:"after",speed:"slow",theme:"error",sticky:0})}function validateNum(e,t,a){var r=+e;return t<=r&&r<=a&&e===r.toString()}function rand_str(e,t){return t=t||"",e?rand_str(--e,"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz".charAt(Math.floor(60*Math.random()))+t):t}function getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e)+e)}function add_record(e,t,a,r,s){id+=1,table.row.add([id,e,t,a,r,'<a href="javascript:void(0)" id="more_details">'+s.slice(0,20)+'...</a><span class="more_details_text">'+s+"</span>"]).draw(!1)}function simulate_logs(){clearInterval(simulate_timer);var a=["Notice","Warning","Error","Critical","Fatal"];simulate_timer=setInterval(function(){var e=new Date,t=e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds();add_record(rand_str(10),a[getRandomInt(0,4)],rand_str(10),t,rand_str(500))},1e3)}$(document).on("submit","form.address_form",function(e){var t;return e.preventDefault(),"connect"!=$(".connect").attr("id")||"TEST"!=$(".address").val()&&!isIpAddressValid($(".address").val())?"reconnect"==$(".connect").attr("id")?($(".address").removeAttr("disabled"),$(".address").val(""),$(".connect").attr("value","Подключиться"),$(".connect").attr("id","connect"),$("#logs tbody tr").remove(),table.clear().draw(),id=0,clearInterval(simulate_timer)):jQuery.jGrowl("Вы ввели неправильный IP.",{life:5e3,glue:"after",speed:"slow",theme:"error",sticky:0}):($(".connect").attr("id","reconnect"),$(".address").attr("disabled","disabled"),$(".connect").attr("value","Поменять устройство"),jQuery.jGrowl("Вы успешно подключились.",{life:5e3,glue:"after",speed:"slow",theme:"status",sticky:0}),"TEST"==$(".address").val()?(table.clear().draw(),id=0,simulate_logs()):isIpAddressValid($(".address").val())&&(t="ws://"+$(".address").val(),new WebSocket(t).onmessage=function(e){var t=JSON.parse(event.data);add_record(t.event,t.importance,t.device_id,t.timestamp,t.details)})),console.log($(".address").val()),!1}),$(document).on("click","#more_details",function(){return $("#dialog").text($(this).parent().find(".more_details_text").text()),$("#dialog").dialog("open"),!1}),$(document).ready(function(){$(".address").on("input",function(){$(this).val($(this).val().toUpperCase())}),table=$("#logs").DataTable({language:{search:"_INPUT_",searchPlaceholder:"Поиск",info:"От _START_ до _END_ из _TOTAL_ записей",infoEmpty:"Записей нет",lengthMenu:"Показать _MENU_ записей",zeroRecords:"Записей нет",paginate:{next:"Следующая страница",previous:"Предыдущая страница"},dom:"Bfrtip",buttons:["copy","csv","excel","pdf","print"]}}),$("#logs tbody").on("click","tr",function(){$(this).hasClass("selected")?$(this).removeClass("selected"):(table.$("tr.selected").removeClass("selected"),$(this).addClass("selected"))}),$("#dialog").dialog({autoOpen:!1,modal:!0,closeText:""})});